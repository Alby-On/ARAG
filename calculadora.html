<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Solar - Selector de Tiempo</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 20px; background-color: #f4f7f6; }
        .container { max-width: 1150px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { color: #1b5e20; text-align: center; border-bottom: 2px solid #4caf50; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #4caf50; color: white; }
        .btn-add { background: #2196f3; color: white; padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 15px; }
        .btn-del { background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
        input, select { width: 95%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; box-sizing: border-box; }
        .total-row { background-color: #f1f8e9; font-weight: bold; color: #2e7d32; font-size: 1.1em; }
      .resumen-container {
    display: flex;
    gap: 20px;
    margin-top: 30px;
    justify-content: space-between;
}
.resumen-card {
    flex: 1;
    background: #ffffff;
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    border-top: 5px solid #1976d2;
}
.resumen-card.highlight {
    border-top: 5px solid #4caf50;
    background: #f1f8e9;
}
.resumen-label {
    display: block;
    font-size: 0.9em;
    color: #666;
    text-transform: uppercase;
    font-weight: bold;
    margin-bottom: 10px;
}
.resumen-valor {
    font-size: 2.2em;
    font-weight: 800;
    color: #333;
}
.resumen-valor small {
    font-size: 0.5em;
    color: #888;
}
.resumen-desc {
    font-size: 0.85em;
    color: #999;
    margin-top: 5px;
}
@media (max-width: 768px) {
    .resumen-container { flex-direction: column; }
}
.formulario-container {
    background: #2e7d32;
    padding: 30px;
    border-radius: 15px;
    margin-top: 40px;
    color: white;
}
.formulario-container h3 {
    margin-top: 0;
    text-align: center;
    font-size: 1.5em;
}
.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}
.form-group {
    display: flex;
    flex-direction: column;
}
.form-group label {
    margin-bottom: 8px;
    font-weight: bold;
    font-size: 0.9em;
}
.form-group select, .form-group input {
    padding: 12px;
    border: none;
    border-radius: 5px;
    font-size: 1em;
}
.btn-next {
    width: 100%;
    margin-top: 25px;
    background: #ffc107;
    color: #333;
    border: none;
    padding: 15px;
    font-size: 1.1em;
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.3s;
}
.btn-next:hover {
    background: #ffca28;
}
.form-group input[readonly] {
    background-color: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.4);
    font-weight: bold;
}
.resultado-propuesta {
    background: #ffffff;
    border: 2px solid #2e7d32;
    padding: 25px;
    border-radius: 15px;
    margin-top: 30px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}
.resultado-propuesta h3 { color: #2e7d32; margin-top: 0; text-align: center; }
.grid-resultados {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-top: 20px;
}
.item-res {
    background: #f9f9f9;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    border: 1px solid #eee;
}
.item-res .tit { display: block; font-size: 0.85em; color: #555; font-weight: bold; margin-bottom: 5px; }
.item-res .val { font-size: 1.4em; color: #333; font-weight: 800; }
.total-costo { background: #e8f5e9; border: 1px solid #2e7d32; }
.total-costo .val { color: #2e7d32; }
    </style>
</head>
<body>

<div class="container">
    <h2>Calculadora de Consumo El√©ctrico</h2>
    <button class="btn-add" onclick="addRow()">+ A√±adir Artefacto</button>

    <table id="calcTable">
        <thead>
            <tr>
                <th>Artefacto El√©ctrico</th>
                <th>N¬∞ Equipos</th>
                <th>Potencia (Watts)</th>
                <th>Tiempo de Uso</th>
                <th>kWh / D√≠a</th>
                <th>kWh / Mes</th>
                <th>Acci√≥n</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
        <tfoot>
            <tr class="total-row">
                <td colspan="4">TOTAL CONSUMO ESTIMADO</td>
                <td id="totalDia">0.00</td>
                <td id="totalMes">0.00</td>
                <td></td>
            </tr>
        </tfoot>
    </table>
  <div class="resumen-container">
    <div class="resumen-card">
        <span class="resumen-label">Carga M√°xima de Trabajo</span>
        <div class="resumen-valor"><span id="totalWatts">0</span> <small>W</small></div>
        <p class="resumen-desc">Potencia total instalada</p>
    </div>
    
    <div class="resumen-card highlight">
        <span class="resumen-label">Consumo Diario</span>
        <div class="resumen-valor"><span id="resumenDia">0.00</span> <small>kWh</small></div>
        <p class="resumen-desc">Energ√≠a necesaria por d√≠a</p>
    </div>
    
    <div class="resumen-card">
        <span class="resumen-label">Consumo Mensual</span>
        <div class="resumen-valor"><span id="resumenMes">0.00</span> <small>kWh</small></div>
        <p class="resumen-desc">Energ√≠a total al mes</p>
    </div>
</div>
<div class="formulario-container">
    <h3>Casi listo: Obt√©n tu configuraci√≥n solar</h3>
    <form id="solarLeadForm">
        <div class="form-grid">
            <div class="form-group">
                <label>Tu Regi√≥n:</label>
                <select id="userRegion" required>
                    <option value="" disabled selected>Selecciona tu regi√≥n...</option>
                    <option value="6.5">Arica y Parinacota</option>
                    <option value="6.4">Tarapac√°</option>
                    <option value="6.6">Antofagasta</option>
                    <option value="6.2">Atacama</option>
                    <option value="5.8">Coquimbo</option>
                    <option value="5.2">Valpara√≠so</option>
                    <option value="5.1">Metropolitana de Santiago</option>
                    <option value="4.8">O'Higgins</option>
                    <option value="4.5">Maule</option>
                    <option value="4.2">√ëuble</option>
                    <option value="4.0">Biob√≠o</option>
                    <option value="3.8">La Araucan√≠a</option>
                    <option value="3.5">Los R√≠os</option>
                    <option value="3.2">Los Lagos</option>
                    <option value="2.8">Ays√©n</option>
                    <option value="2.5">Magallanes y la Ant√°rtica Chilena</option>
                </select>
            </div>

            <div class="form-group">
                <label>Potencia Total Instalada:</label>
                <input type="text" id="formWatts" readonly>
            </div>

            <div class="form-group">
                <label>Consumo Mensual:</label>
                <input type="text" id="formKwhMes" readonly>
            </div>
        </div>

        <button type="button" class="btn-next" onclick="nextStep()">Siguiente: Calcular Paneles ‚ûî</button>
    </form>
</div>
<div id="resultadoFinal" class="resultado-propuesta" style="display: none;">
    <h3>üìä Propuesta T√©cnica Estimada</h3>
    <div class="grid-resultados">
        <div class="item-res">
            <span class="tit">Inversor Recomendado</span>
            <span class="val" id="resInversor">0 kW</span>
        </div>
        <div class="item-res">
            <span class="tit">Paneles (Mono-PERC 580W)</span>
            <span class="val" id="resPaneles">0 Unidades</span>
        </div>
        <div class="item-res">
            <span class="tit">Banco de Bater√≠as Litio</span>
            <span class="val" id="resBaterias">0 kWh</span>
        </div>
        <div class="item-res total-costo">
            <span class="tit">Inversi√≥n Estimada (IVA Inc.)</span>
            <span class="val" id="resCosto">$0</span>
        </div>
    </div>
    <p style="font-size: 0.8em; margin-top: 15px; color: #666;">*Valores referenciales sujetos a factibilidad t√©cnica y variaciones de mercado.</p>
</div>
</div>

<script>
    const categorias = {
        "üîå Electrodom√©sticos": {
            "Ampolleta LED": 9, "Ampolleta incandescente": 60, "Televisor LED 32\"": 80,
            "Televisor LED 50\"": 120, "Refrigerador": 150, "Microondas": 1200,
            "Hervidor el√©ctrico": 2000, "Lavadora": 800, "Secadora de ropa": 2500,
            "Aspiradora": 1400, "Plancha": 1200, "Horno el√©ctrico": 2000, "Tostador": 800
        },
        "üíª Electr√≥nica y Oficina": {
            "Notebook": 60, "PC de escritorio": 300, "Monitor LED": 30,
            "Router WiFi": 10, "Impresora": 500, "Cargador celular": 5,
            "Consola de videojuegos": 200, "C√°mara de seguridad": 10
        },
        "üõ†Ô∏è Fuerza y Climatizaci√≥n": {
            "Taladro": 600, "Esmeril angular": 800, "Sierra circular": 1400,
            "Soldadora inverter": 3000, "Compresor de aire peque√±o": 1500,
            "Ventilador": 60, "Estufa el√©ctrica": 2000, "Aire acondicionado 9000 BTU": 900,
            "Aire acondicionado 12000 BTU": 1200, "Bomba de agua 1/2 HP": 750,
            "Bomba de agua 1 HP": 1500, "Port√≥n el√©ctrico": 500
        }
    };

    function addRow() {
        const tbody = document.getElementById('tableBody');
        const row = document.createElement('tr');
        
        // Generar Select de Artefactos
        let artOptions = '<option value="" disabled selected>Seleccione...</option>';
        for (let cat in categorias) {
            artOptions += `<optgroup label="${cat}">`;
            for (let art in categorias[cat]) {
                artOptions += `<option value="${categorias[cat][art]}">${art}</option>`;
            }
            artOptions += `</optgroup>`;
        }

        // Generar Select de Tiempo (Minutos y Horas)
        let timeOptions = '<option value="0" selected>0 min/hrs</option>';
        timeOptions += '<optgroup label="Minutos">';
        timeOptions += '<option value="0.083">5 min</option>';
        timeOptions += '<option value="0.166">10 min</option>';
        timeOptions += '<option value="0.25">15 min</option>';
        timeOptions += '<option value="0.5">30 min</option>';
        timeOptions += '</optgroup>';
        timeOptions += '<optgroup label="Horas">';
        for (let i = 1; i <= 24; i++) {
            timeOptions += `<option value="${i}">${i} hora${i>1?'s':''}</option>`;
        }
        timeOptions += '</optgroup>';

        row.innerHTML = `
            <td><select onchange="updateWatts(this)">${artOptions}</select></td>
            <td><input type="number" value="1" min="1" oninput="calculate(this)"></td>
            <td><input type="number" value="0" oninput="calculate(this)"></td>
            <td><select onchange="calculate(this)">${timeOptions}</select></td>
            <td class="kwh-dia">0.00</td>
            <td class="kwh-mes">0.00</td>
            <td><button class="btn-del" onclick="removeRow(this)">X</button></td>
        `;
        tbody.appendChild(row);
    }

    function updateWatts(selectEl) {
        const row = selectEl.closest('tr');
        const powerInput = row.cells[2].querySelector('input');
        powerInput.value = selectEl.value;
        calculate(powerInput);
    }

    function calculate(el) {
        const row = el.closest('tr');
        const qty = parseFloat(row.cells[1].querySelector('input').value) || 0;
        const watts = parseFloat(row.cells[2].querySelector('input').value) || 0;
        const hours = parseFloat(row.cells[3].querySelector('select').value) || 0;

        const kwhDia = (qty * watts * hours) / 1000;
        const kwhMes = kwhDia * 30;

        row.querySelector('.kwh-dia').innerText = kwhDia.toFixed(3);
        row.querySelector('.kwh-mes').innerText = kwhMes.toFixed(2);

        updateTotals();
    }

function updateTotals() {
    let totalW = 0, totalD = 0, totalM = 0;
    
    // Recorremos las filas para sumar Watts totales y kWh
    document.querySelectorAll('#tableBody tr').forEach(row => {
        const qty = parseFloat(row.cells[1].querySelector('input').value) || 0;
        const watts = parseFloat(row.cells[2].querySelector('input').value) || 0;
        const kDia = parseFloat(row.querySelector('.kwh-dia').innerText) || 0;
        const kMes = parseFloat(row.querySelector('.kwh-mes').innerText) || 0;
        
        totalW += (qty * watts);
        totalD += kDia;
        totalM += kMes;
    });
    
    // Actualizar los totales de la tabla
    document.getElementById('totalDia').innerText = totalD.toFixed(3);
    document.getElementById('totalMes').innerText = totalM.toFixed(2);
    
    // Actualizar el nuevo cuadro de resumen llamativo
    document.getElementById('totalWatts').innerText = totalW.toLocaleString(); // con separador de miles
    document.getElementById('resumenDia').innerText = totalD.toFixed(2);
    document.getElementById('resumenMes').innerText = totalM.toFixed(1);

    // Actualizar los campos del formulario (Capa de datos)
    document.getElementById('formWatts').value = totalW.toLocaleString() + " W";
    document.getElementById('formKwhMes').value = totalM.toFixed(2) + " kWh/mes";
}

    function removeRow(btn) {
        btn.closest('tr').remove();
        updateTotals();
    }

    window.onload = addRow;
function nextStep() {
    const region = document.getElementById('userRegion').value;
    if (!region) {
        alert("Por favor, selecciona tu regi√≥n para calcular la radiaci√≥n.");
        return;
    }
    
    // Aqu√≠ podr√≠as mostrar un modal, otra secci√≥n o enviar los datos
    alert("¬°Datos capturados! Calculando paneles para la regi√≥n de " + region);
    // Pr√≥ximo paso: Generar propuesta t√©cnica
}
function nextStep() {
    const hsp = parseFloat(document.getElementById('userRegion').value);
    if (!hsp) {
        alert("Por favor, selecciona tu regi√≥n para calcular.");
        return;
    }

    // 1. Obtener datos de los inputs (limpiando texto para dejar solo n√∫meros)
    const totalWattsCarga = parseFloat(document.getElementById('formWatts').value.replace(/\D/g,'')) || 0;
    const kwhMes = parseFloat(document.getElementById('formKwhMes').value) || 0;
    const kwhDia = kwhMes / 30;

    // 2. C√°lculo de Inversor: Carga m√°xima + 20% de margen de seguridad
    const potenciaInversor = (totalWattsCarga * 1.2) / 1000; 
    
    // 3. C√°lculo de Paneles (580W)
    // F√≥rmula: (kWh d√≠a / (HSP * Eficiencia 0.75)) / Potencia Panel
    const potenciaInstalarWp = (kwhDia / (hsp * 0.75)) * 1000;
    const numPaneles = Math.ceil(potenciaInstalarWp / 580);

    // 4. Capacidad Bater√≠as (Ejemplo: Cubrir 1 d√≠a de autonom√≠a)
    // Generalmente se recomienda 1.5 a 2 veces el consumo diario para litio
    const capacidadBateria = kwhDia * 1.5;

    // 5. Costo Estimado (Aproximaci√≥n: $1.200.000 por kWp instalado + Bater√≠as)
    // Ajustado con IVA (19%)
    const costoBase = (potenciaInstalarWp * 1100) + (capacidadBateria * 350000);
    const costoTotalConIva = costoBase * 1.19;

    // Mostrar Resultados en el HTML
    document.getElementById('resInversor').innerText = potenciaInversor.toFixed(1) + " kW";
    document.getElementById('resPaneles').innerText = numPaneles + " Unidades";
    document.getElementById('resBaterias').innerText = capacidadBateria.toFixed(1) + " kWh";
    document.getElementById('resCosto').innerText = "$" + Math.round(costoTotalConIva).toLocaleString('es-CL');

    // Mostrar el recuadro
    document.getElementById('resultadoFinal').style.display = 'block';
    
    // Scroll suave hacia el resultado
    document.getElementById('resultadoFinal').scrollIntoView({ behavior: 'smooth' });
}
</script>

</body>
</html>
